<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Club Webradio LFIT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Courier Prime', monospace;
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    body {
      display: flex;
      background: #f2f2f2;
    }
    .sidebar {
      width: 300px;
      background: orange;
      padding: 1.5rem;
      overflow-y: auto;
      position: fixed;
      left: 0; top: 0; bottom: 0;
    }
    .sidebar h2 {
      color: white;
      text-align: center;
    }
    .logo {
      display: block;
      margin: 0 auto 1rem;
      width: 80%;
    }
    .presentation {
      background: #fff3e0;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-size: 1rem;
      overflow: hidden;
    }
    .presentation a {
      text-decoration: none;
      color: orange;
    }
    .playlist-bubble {
      background: white;
      border-radius: 20px;
      padding: 10px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      font-weight: bold;
      color: orange;
    }
    .playlist-bubble:hover {
      background: #ffe6b3;
      transform: scale(1.05);
    }
    .playlist-episodes {
      display: none;
      margin-top: 8px;
      padding-left: 10px;
    }
    .playlist-bubble:hover .playlist-episodes {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    .playlist-episodes a {
      display: block;
      color: black;
      margin: 3px 0;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .main-content {
      margin-left: 300px;
      padding: 1rem;
      flex: 1;
      overflow-y: auto;
      height: 100vh;
    }
    .search-bar {
      margin-bottom: 1rem;
    }
    .search-bar input {
      width: 100%;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    .podcast {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }
    .podcast:hover {
      transform: translateY(-5px);
    }
    .podcast h3 {
      margin: 0.2rem 0;
      font-size: 1rem;
    }
    .podcast img {
      width: 100%;
      max-width: 300px;
      border-radius: 10px;
      margin-bottom: 0.5rem;
    }
    .podcast .desc {
      font-size: 0.9rem;
      color: #333;
      margin: 0.5rem 0;
    }
    .actions {
      margin-top: 0.5rem;
    }
    .actions a {
      display: inline-block;
      background: orange;
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      text-decoration: none;
      font-size: 0.9rem;
      margin-right: 10px;
    }
    .actions button {
      background: #ff9800;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 15px;
      cursor: pointer;
    }
    #global-player {
      position: fixed;
      bottom: 0;
      left: 300px;
      right: 0;
      background: orange;
      padding: 10px;
      box-shadow: 0 -3px 10px rgba(0,0,0,0.2);
    }
    #global-player audio {
      width: 100%;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <img src="https://via.placeholder.com/150" alt="Logo Webradio" class="logo" id="site-logo">
    <div class="presentation" id="site-presentation">
      Bonjour,<br>
      Bienvenue sur la plateforme de publication du <strong>Club Webradio du Lycée Français International de Tokyo</strong> !<br>
      Bonne écoute !<br><br>
      Une question ?<br>
      Envie de rejoindre le club ?<br>
      Écrivez à : <a href="mailto:club_webradio@lfitokyo.org">club_webradio@lfitokyo.org</a>
    </div>
    <h2>Playlists</h2>
    <div class="playlist-bubble" id="blagues">
      Blagues
      <div class="playlist-episodes" id="blagues-list"></div>
    </div>
    <div class="playlist-bubble" id="interviews">
      Interviews
      <div class="playlist-episodes" id="interviews-list"></div>
    </div>
    <div class="playlist-bubble" id="contes">
      Contes
      <div class="playlist-episodes" id="contes-list"></div>
    </div>
  </div>

  <div class="main-content">
    <div class="search-bar">
      <input type="text" id="search-input" placeholder="Rechercher un podcast...">
    </div>
    <div id="podcast-container">Chargement...</div>
  </div>

  <div id="global-player">
    <audio id="main-audio" controls></audio>
  </div>

  <script>
    const feedUrl = "https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Faudioblog.arteradio.com%2Fblog%2F237102%2Frss";
    let podcasts = [];

    async function fetchPodcasts() {
      try {
        const res = await fetch(feedUrl);
        const data = await res.json();
        podcasts = data.items;
        displayPodcasts(podcasts);
        categorizePlaylists();
        if (data.feed.image) {
          document.getElementById("site-logo").src = data.feed.image;
        }
        document.getElementById("site-presentation").innerHTML = `
          Bonjour,<br>
          Bienvenue sur la plateforme de publication du <strong>Club Webradio du Lycée Français International de Tokyo</strong> !<br>
          Bonne écoute !<br><br>
          Une question ?<br>
          Envie de rejoindre le club ?<br>
          Écrivez à : <a href="mailto:club_webradio@lfitokyo.org">club_webradio@lfitokyo.org</a>
        `;
      } catch (err) {
        console.error("Erreur chargement RSS :", err);
      }
    }

    function displayPodcasts(list) {
      const container = document.getElementById("podcast-container");
      container.innerHTML = "";
      list.forEach(item => {
        const div = document.createElement("div");
        div.className = "podcast";
        div.innerHTML = `
          <img src="${item.thumbnail}" alt="Image de ${item.title}">
          <h3>${item.title}</h3>
          <div class="desc">${item.description}</div>
          <div class="actions">
            <button onclick="loadInPlayer('${item.enclosure.link}')">Écouter</button>
            <a href="${item.enclosure.link}" download>Télécharger audio</a>
            <a href="${item.thumbnail}" download>Télécharger image</a>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function categorizePlaylists() {
      const categories = {
        blagues: [],
        interviews: [],
        contes: []
      };

      podcasts.forEach(item => {
        const title = item.title.toLowerCase();
        if (title.includes("blague")) categories.blagues.push(item);
        else if (title.includes("interview")) categories.interviews.push(item);
        else if (title.includes("conte")) categories.contes.push(item);
      });

      for (let key in categories) {
        const container = document.getElementById(`${key}-list`);
        container.innerHTML = "";
        categories[key].forEach(ep => {
          const a = document.createElement("a");
          a.href = "#";
          a.innerText = ep.title;
          a.onclick = () => {
            loadInPlayer(ep.enclosure.link);
            return false;
          };
          container.appendChild(a);
        });
      }
    }

    function loadInPlayer(url) {
      const player = document.getElementById("main-audio");
      player.src = url;
      player.play();
    }

    document.getElementById("search-input").addEventListener("input", e => {
      const val = e.target.value.toLowerCase();
      const filtered = podcasts.filter(p => p.title.toLowerCase().includes(val));
      displayPodcasts(filtered);
    });

    window.onload = fetchPodcasts;
  </script>
</body>
</html>